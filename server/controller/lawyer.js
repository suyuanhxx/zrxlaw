/** * Created by 1 on 2017/1/10. * @author huangxiaoxu */'use strict';require('../model/Lawyer');var mongoose = require('mongoose');var Lawyer = mongoose.model('Lawyer');var tools = require('../common/tools');var logger = require('../common/logger');var result = require('../common/result');/** * 瀑布流读取所有律师信息 * page  页码 * size  每页数据条数 * @param req {page,size,count}k * @param res {count 总数据条数,docs} */exports.getLawyersByWaterFlow = function (req, res) {    var condition = '';    var page = req.params.page;    var size = req.params.size;    if (undefined == size || '' == size) {        size = 10;    }    queryLawyers(condition, page, size, function (err, docs) {        if (err) {            result.code = 0;            result.msg = err.errmsg;            res.json(result);            return;        }        else {            Lawyer.find().count(function (err, count) {                if (err) {                    logger.info(err.errmsg);                }                result.data = docs;                result.count = count;                return res.json(result);            });        }    });};//获取所有用户exports.getTopLawyers = function (req, res) {    var condition = {order: 1};    // var docs = queryLawyers(condition,next);    queryLawyers(condition, 0, 0, function (err, docs) {        if (err) {            return;        }        logger.info("getLTopLawyers result is:", docs);        result.code = 1;        result.data = docs;        result.msg = "success";        return res.json(result);    });};/** * 根据输入关键字模糊查询 * @param req * @param res */exports.getLawyer = function (req, res) {    var query = {};    console.log(req.params.keyword);    if (req.params.keyword) {        query['LawyerName'] = new RegExp(/req.params.keyword/);//模糊查询参数    }    console.log(query);    Lawyer.find(query, function (err, docs) {        return res.json({"status": "success", "data": docs});    });};/** * 根据用户名查询 * @param req * @param res */exports.getLawyerbyUsername = function (req, res) {    var username = req.params.username;    console.log(username);    Lawyer.findOne({username: username}, function (err, docs) {        return res.json({"status": "success", "data": docs});    });};/** * 添加律师信息 * @param req * @param res */exports.addLawyer = function (req, res) {    var newLawyer = new Lawyer();    console.log(tools.generatorUsername());    newLawyer.username = tools.generatorUsername();    newLawyer.jobNumber = req.body.jobNumber;    newLawyer.LawyerName = req.body.LawyerName;    newLawyer.nickname = req.body.nickname;    newLawyer.avatar = req.body.avatar;    newLawyer.gender = req.body.gender;    newLawyer.age = req.body.age;    newLawyer.phone = req.body.phone;    newLawyer.wechatId = req.body.wechatId;    newLawyer.email = req.body.email;    newLawyer.description = req.body.description;    newLawyer.position = req.body.position;    newLawyer.joinTime = Date.now();    newLawyer.status = 1;    console.log(newLawyer);    newLawyer.save(function (err) {        if (err) {            return res.json({"status": "error"})        } else {            return res.json({"status": "success"});        }    });};/** * 查询律师信息 * @param condition * @param page * @param size * @param callback */var queryLawyers = function (condition, page, size, callback) {    var query = Lawyer.find(condition);    if (Number(page) >= 1) {        query.skip(Number(page) - 1);    }    if (Number(size)) {        query.limit(Number(size));    }    query.select('LawyerName position description avatar');    query.exec(function (err, docs) {        callback(err, docs);    });};