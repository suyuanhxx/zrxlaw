/** * Created by 1 on 2017/1/10. * @author huangxiaoxu */'use strict';require('../model/lawer');var mongoose = require('mongoose');var Lawer = mongoose.model('Lawer');var tools = require('../common/tools');var logger = require('../common/logger');var result = require('../common/result');/** * 瀑布流读取所有律师信息 * page  页码 * size  每页数据条数 * @param req {page,size,count}k * @param res {count 总数据条数,docs} */exports.getLawersByWaterFlow = function (req, res) {    var condition = '';    var page = req.params.page;    var size = req.params.size;    if (undefined == size || '' == size) {        size = 10;    }    queryLawers(condition, page, size, function (err, docs) {        if (err) {            result.code = 0;            result.msg = err.errmsg;            res.json(result);            return;        }        else {            Lawer.find().count(function (err, count) {                if (err) {                    logger.info(err.errmsg);                }                result.data = docs;                result.count = count;                return res.json(result);            });        }    });};//获取所有用户exports.getTopLawers = function (req, res) {    var condition = {order: 1};    // var docs = queryLawers(condition,next);    queryLawers(condition, 0, 0, function (err, docs) {        if (err) {            return;        }        logger.info("getLTopLawers result is:", docs);        result.code = 1;        result.data = docs;        result.msg = "success";        return res.json(result);    });};/** * 根据输入关键字模糊查询 * @param req * @param res */exports.getLawer = function (req, res) {    var query = {};    console.log(req.params.keyword);    if (req.params.keyword) {        query['lawerName'] = new RegExp(/req.params.keyword/);//模糊查询参数    }    console.log(query);    Lawer.find(query, function (err, docs) {        return res.json({"status": "success", "data": docs});    });};/** * 根据用户名查询 * @param req * @param res */exports.getLawerbyUsername = function (req, res) {    var username = req.params.username;    console.log(username);    Lawer.findOne({username: username}, function (err, docs) {        return res.json({"status": "success", "data": docs});    });};/** * 添加律师信息 * @param req * @param res */exports.addLawer = function (req, res) {    var newLawer = new Lawer();    console.log(tools.generatorUsername());    newLawer.username = tools.generatorUsername();    newLawer.jobNumber = req.body.jobNumber;    newLawer.lawerName = req.body.lawerName;    newLawer.nickname = req.body.nickname;    newLawer.avatar = req.body.avatar;    newLawer.gender = req.body.gender;    newLawer.age = req.body.age;    newLawer.phone = req.body.phone;    newLawer.wechatId = req.body.wechatId;    newLawer.email = req.body.email;    newLawer.description = req.body.description;    newLawer.position = req.body.position;    newLawer.joinTime = Date.now();    newLawer.status = 1;    console.log(newLawer);    newLawer.save(function (err) {        if (err) {            return res.json({"status": "error"})        } else {            return res.json({"status": "success"});        }    });};/** * 查询律师信息 * @param condition * @param page * @param size * @param callback */var queryLawers = function (condition, page, size, callback) {    var query = Lawer.find(condition);    if (Number(page) >= 1) {        query.skip(Number(page) - 1);    }    if (Number(size)) {        query.limit(Number(size));    }    query.select('lawerName position description avatar');    query.exec(function (err, docs) {        callback(err, docs);    });};